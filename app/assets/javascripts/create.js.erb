
<% 
# This file is for displaying search results from user input in plant creation.
# Should update a text_fields suggestions with displayed names from a search.
# This allows the following searches first result to be the intended location.

# https://nominatim.openstreetmap.org/search/<query>?<params>
# https://nominatim.openstreetmap.org/search?q=17+Strada+Pictor+Alexandru+Romano%2C+Bukarest&format=geojson
%>

function search_locations() {
    
      Rails.ajax({
      url: "/get_geocode_results?string=" + Rails.$(".loc-field")[0].value,
      type: "get",
      success:  function retData(data){
      results_array = data.split("|")
      <%# alert("First result is "+results_array[0]+"\nSecond Result is "+results_array[1]+"\nThird Result is "+results_array[2]+"\nFourth Result is "+results_array[3]) %>
      location_field = Rails.$(".loc-field")[0]
      <%# location_field.value = results_array[0] %>
      links = [ document.createElement("A"), document.createElement("A"), document.createElement("A"), document.createElement("A") ]
      
      location_field.classList.add("suggest")

      if(Rails.$(".location_field")[0].childElementCount<4){
        for (i=0;i<4;i++) {
          links[i].className = "location-suggest-"+i
          links[i].innerHTML = results_array[i];
          links[i].onclick = function() { Rails.$(".loc-field")[0].value = this.innerHTML; remove_links() }
        }
        for (i=0;i<4;i++) {
            if (results_array[i].length > 0) { Rails.$(".location_field")[0].appendChild(links[i]); }
        }
      }else{
        Rails.$(".location-suggest-0")[0].innerHTML = results_array[0]
        Rails.$(".location-suggest-1")[0].innerHTML = results_array[1]
        Rails.$(".location-suggest-2")[0].innerHTML = results_array[2]
        Rails.$(".location-suggest-3")[0].innerHTML = results_array[3]
      }
      }
    }
  )
} 

function remove_links() {
    Rails.$(".loc-field")[0].classList.remove("suggest")
    Rails.$(".location-suggest-0")[0].remove()
    Rails.$(".location-suggest-1")[0].remove()
    Rails.$(".location-suggest-2")[0].remove()
    Rails.$(".location-suggest-3")[0].remove()
}
